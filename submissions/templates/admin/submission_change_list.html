{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div id="summary">
  <h2>Summary</h2>
  <ul>
  {% for key, value in summary %}
    <li>{{ key|capfirst }}: {{ value }}</li>
  {% endfor %}
  </ul>
</div>

<div id="chart">
  <canvas id="submissionChart" width="400" height="200"></canvas>
</div>

{{ summary_over_time|json_script:"summary-data" }}

<script>
  var ctx = document.getElementById('submissionChart').getContext('2d');
  var data = JSON.parse(document.getElementById('summary-data').textContent);
  var chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.map(item => item.x),
      datasets: [{
        label: 'Total Submissions',
        data: data.map(item => item.total),
        borderColor: 'blue',
        fill: false
      }, {
        label: 'Verified Submissions',
        data: data.map(item => item.verified),
        borderColor: 'green',
        fill: false
      }, {
        label: 'Certificates Available',
        data: data.map(item => item.certificates_available),
        borderColor: 'red',
        fill: false
      }]
    },
    options: {
      responsive: true,
      title: {
        display: true,
        text: 'Submissions Over Time'
      },
      scales: {
        xAxes: [{
          type: 'time',
          time: {
            unit: 'day',
            displayFormats: {
              day: 'MMM D'
            }
          }
        }]
      }
    }
  });
</script>

{{ block.super }}
{% endblock %}